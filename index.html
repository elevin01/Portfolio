<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Emil Levin Portfolio</title>
  <link rel="stylesheet" href="css/styles.css" />
  <link href="https://fonts.googleapis.com/css?family=Inter:400,700&display=swap" rel="stylesheet" />
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-top">
      <div class="profile">
        <h1>Emil Thomas Levin</h1>
        <p class="title">Automation Engineer</p>
        <p class="statement">
          I turn wasted effort into meaningful impact.
        </p>
        <!-- Social buttons -->
        <div class="social-links">
          <!-- Email Button -->
          <a href="mailto:emiltlevin@gmail.com" class="social-btn">
            <!-- Envelope SVG icon -->
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
              <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v.217l-8 4.8-8-4.8V4zm0 2.383l7.555 4.533a.5.5 0 0 0 .89 0L16 6.383V12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6.383z"/>
            </svg>
            <span>Email</span>
          </a>
          <!-- LinkedIn Button -->
          <a href="https://linkedin.com/in/elevin01" target="_blank" class="social-btn">
            <!-- LinkedIn SVG icon -->
            <span style="display: inline-flex; align-items: center; gap: 0.3em;">
              <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                <path d="M20.5 2h-17A1.5 1.5 0 0 0 2 3.5v17A1.5 1.5 0 0 0 3.5 22h17a1.5 1.5 0 0 0 1.5-1.5v-17A1.5 1.5 0 0 0 20.5 2zM8 19H5v-9h3zM6.5 8.25A1.75 1.75 0 1 1 8.3 6.5a1.78 1.78 0 0 1-1.8 1.75zM19 19h-3v-4.74c0-1.42-.6-1.93-1.38-1.93A1.74 1.74 0 0 0 13 14.19V19h-3v-9h2.9v1.3a3.11 3.11 0 0 1 2.7-1.4c1.55 0 3.36.86 3.36 3.66z" 
                      transform="translate(0, -0.5) scale(1.05, 1.05)"/>
              </svg>
              <span style="margin-left: 0.25em;">LinkedIn</span>
            </span>
          </a>          
          <!-- GitHub Button -->
          <a href="https://github.com/elevin01" target="_blank" class="social-btn">
            <!-- GitHub SVG icon -->
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
              <path d="M8 0C3.58 0 0 3.58 0 8a8 8 0 0 0 5.47 7.59c.4.074.55-.174.55-.388 0-.192-.007-.7-.01-1.376-2.23.484-2.7-1.076-2.7-1.076-.364-.924-.89-1.17-.89-1.17-.727-.497.055-.487.055-.487.803.057 1.225.825 1.225.825.715 1.224 1.874.87 2.33.666.072-.517.28-.87.508-1.07-1.78-.202-3.644-.89-3.644-3.96 0-.876.312-1.59.823-2.15-.083-.203-.357-1.017.078-2.12 0 0 .67-.214 2.2.82a7.61 7.61 0 0 1 2-.268c.68.003 1.36.092 2 .268 1.53-1.034 2.2-.82 2.2-.82.435 1.104.16 1.918.078 2.12.513.56.823 1.274.823 2.15 0 3.08-1.867 3.756-3.65 3.954.288.248.543.737.543 1.486 0 1.07-.01 1.93-.01 2.19 0 .216.15.466.55.387A8.001 8.001 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
            </svg>
            <span>GitHub</span>
          </a>
          <!-- Download Resume Button -->
          <a href="Resume_Emil2025[Gen].pdf" class="download-btn" download>
            <!-- Download SVG icon -->
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
              <path d="M.5 9.9V14a1 1 0 0 0 1 1h13a1 1 0 0 0 1-1V9.9a.5.5 0 0 0-1 0V14H1.5V9.9a.5.5 0 0 0-1 0z"/>
              <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
            </svg>
            <span>Resume</span>
          </a>
        </div>
      </div>
    </div>
    <div class="sidebar-middle">
      <nav class="nav">
        <ul>
          <li class="active"><a href="#about">About Me</a></li>
          <li class="hide-on-medium"><a href="#education">Education</a></li>
          <li><a href="#experience">Experience</a></li>
          <li><a href="#projects">Projects</a></li>
          <li class="hide-on-medium"><a href="#contact">Contact</a></li>
        </ul>
      </nav>
    </div>
    <div class="sidebar-bottom">
      <footer class="sidebar-footer">
        <p>&copy; 2025 Emil Levin</p>
      </footer>
    </div>
  </aside>

  <!-- Main content area -->
  <main class="content">
    <!-- About Section -->
    <section id="about" class="section">
      <h2>About Me</h2>
      <p> 
        Automation engineer with 2+ years turning manual, error-prone workflows into scalable self-serve systems that cut busywork and tighten data. I build tools that keep operations reliable and auditable and advise an early-stage startup using computer vision to reduce medication errors.      </p>
      <p>
    </p>
      <div class="skills">
        <h3>Technical Skills</h3>
        <ul class="skills-list">
          <li>
            <span class="skill-label">Programming</span>
            <div class="skill-badges">
              <span class="skill-badge python">Python</span>
              <span class="skill-badge cpp">C++</span>
              <span class="skill-badge csharp">C#</span>
              <span class="skill-badge java">Java</span>
            </div>
          </li>
          <li>
            <span class="skill-label">Web</span>
            <div class="skill-badges">
              <span class="skill-badge html">HTML</span>
              <span class="skill-badge css">CSS</span>
              <span class="skill-badge js">JavaScript</span>
              <span class="skill-badge php">PHP</span>
            </div>
          </li>
          <li>
            <span class="skill-label">Database</span>
            <div class="skill-badges">
              <span class="skill-badge sql">SQL</span>
              <span class="skill-badge mysql">MySQL</span>
              <span class="skill-badge postgres">PostgreSQL</span>
            </div>
          </li>
          <li>
            <span class="skill-label">Mobile</span>
            <div class="skill-badges">
              <span class="skill-badge ios">iOS</span>
              <span class="skill-badge swift">Swift</span>
              <span class="skill-badge objc">Objective-C++</span>
              <span class="skill-badge android">Android</span>
              <span class="skill-badge kotlin">Kotlin</span>
            </div>
          </li>
          <li>
            <span class="skill-label">Tools &amp; Frameworks</span>
            <div class="skill-badges">
              <span class="skill-badge docker">Docker</span>
              <span class="skill-badge k8s">Kubernetes</span>
              <span class="skill-badge firebase">Firebase</span>
              <span class="skill-badge git">Git</span>
              <span class="skill-badge power-apps">Power Apps</span>
              <span class="skill-badge power-bi">Power BI</span>
              <span class="skill-badge power-automate">Power Automate</span>
            </div>
          </li>
        </ul>
      </div>
    </section>

    <section id="education" class="section education-section">
      <h2>Education</h2>
      <div class="education-list">
        <div class="education-item">
          <div class="education-header">
            <div>
              <p class="edu-school">Manhattan University <span class="edu-note">(formerly Manhattan College)</span></p>
              <p class="edu-degree">B.S. Computer Science — AI &amp; Machine Learning Concentration</p>
            </div>
            <p class="education-meta">Graduated May 2025 &bull; GPA 3.68 &bull; Riverdale, NY</p>
          </div>
          <ul class="edu-highlights">
            <li>Dean's List (2022 – 2025), Epsilon Sigma Pi, Tau Sigma Kappa, Next in Merit for Computer Science Medal.</li>
            <li>Coursework: Data Structures &amp; Algorithms, Object Oriented Programming, Software Engineering, Cloud Computing &amp; Virtualization, Cyber Security, Computer Networks, Operating System (Linux), Data Mining, Neural Network &amp; Learning Systems.</li>
            <li>Clubs: ACM (Secretary, October 2022 – May 2024).</li>
          </ul>
        </div>
      </div>
    </section>

    <section id="experience" class="section">
      <h2>Experience</h2>
      <div class="timeline">
       <div class="timeline-item">
        <div class="timeline-header">
          <h4 class="role">Automation Engineer</h4>
          <span class="company">Con Edison</span>
          <span class="date">September 2025 – Present</span>
        </div>
        <ul class="timeline-details">
          <li>Designed and deployed automated routing, audit trails, targeted reminders, and a controlled interface supporting multi-million-dollar transfers, eliminating bottlenecks, reducing errors, tightening data accuracy, and saving 20+ hours/month.</li>
          <li>Translated business requirements into scalable low-code solutions, workflow automations, data pipelines, and interfaces with Microsoft services and external APIs, improving efficiency, process reliability, and cross-system data integrity.</li>
          <li>Cut manual status reporting by 100%, streamlined project updates and document flow, and gave managers, clients, and dev teams real-time portfolio visibility by overhauling the Project Intake Power App with a full project-tracking system, dynamic milestone logic, non-linear stage progression, priority scoring, multi-view stage layouts, and an executive KPI-dashboard</li> 
        </ul>
      </div>

      <div class="timeline-item">
        <div class="timeline-header">
          <h4 class="role">Software Engineering Intern</h4>
          <span class="company">Orange & Rockland Utilities (Con Edison Subsidiary)</span>
          <span class="date">April 2024 – June 2025</span>
        </div>
        <ul class="timeline-details">
          <li>Digitized paper-based maintenance reports with a Power App that enforced validation, flagged anomalous readings, generated compliance-ready PDFs, and eliminated missing documentation, cutting process time by 45%.</li> 
          <li>Implemented role-based PDF and email routing driven by compliance flags and user inputs, reducing email churn and eliminating manual distribution errors.</li> 
          <li>Designed and deployed an SF6 tracking system that logs cylinder refills, transfers, and losses across equipment, enabling compliance with new environmental regulations by surfacing discrepancies and gas-loss events at each transfer point.</li> 
          <li>Built a centralized logistics request app for external vendor crews, consolidating data entry and improving scheduling speed and team coordination.</li>
          <li>Led QA testing to catch critical logic, calculation, and UI issues pre-launch; authored user documentation and trained 20+ personnel, achieving 30+ processed reports within the first month.</li>  </ul>
      </div>
      
      <div class="timeline-item">
        <div class="timeline-header">
          <h4 class="role">Student Researcher</h4>
          <span class="company">Manhattan College School of Science Summer Research</span>
          <span class="date">June 2023 – August 2023</span>
        </div>
        <ul class="timeline-details">
          <li>Built a Word2Vec-based model to analyze semantic gaps in SNOMED CT medical taxonomy. </li>
          <li>Achieved ~80% accuracy in detecting missing clinical attributes, improving ontology completeness.</li>
          <li>Developed validation scripts in Python/MySQL to detect attribute inconsistencies in clinical data, helping ensure standardized terminology usage in medical records.</li>
          <li>Optimized data processing by indexing, normalizing tables, batching queries, and enabling caching, reducing latency by 30%.</li>
        </ul>
      </div>
      
      <div class="timeline-item">
        <div class="timeline-header">
          <h4 class="role">Peer Mentor (IT Associate)</h4>
          <span class="company">Manhattan College Opportunity Programs</span>
          <span class="date">June 2022 – August 2023</span>
        </div>
        <ul class="timeline-details">
          <li>Provided live and on-call support for setting up enviornments and troubleshooting both software and hardware issues during the summer bridge program.</li>
          <li>Led technical workshops and helped organize and staff orientation logistics for 30+ incoming students</li>
          <li>Managed logistics and scheduling for a small team (5 members) covering tech, events, and meals; coordinated duties and ensured smooth daily operations.</li>
        </ul>
      </div>
      
      <div class="timeline-item">
        <div class="timeline-header">
          <h4 class="role">Co-founder</h4>
          <span class="company">Aeon Scans, Digital Manga Company</span>
          <span class="date">May 2020 – August 2022</span>
        </div>
        <ul class="timeline-details">
          <li>Led a remote team of 50+ across editing, typesetting, dev, design, and translation, producing weekly releases for 15+ manga series reaching 3K-10K readers per chapter.</li>
          <li>Built internal dashboards and bots to automate team tasking, quality control workflows, and recruitment pipelines, cutting manual coordination by ~30%.</li>
          <li>Oversaw release quality and resolved internal conflicts across departments and with external partners, keeping standards high and community feedback minimal.</li>
          <li>Maintained an active community (~500 users) and hosted sneak peeks to keep readers engaged and reduce churn during production lulls.</li>
        </ul>
      </div>
      
      </div>
    </section>

    <!-- Projects Section -->
<section id="projects" class="section">
  <h2>Projects</h2>

  <div class="project">
    <h3>SustainTrail</h3>
    <p><strong>Role:</strong> Product Owner, Scrum Master, Developer, Designer</p>
    <p class="project-summary"> An Android app developed for Capstone. The app transforms sustainability from an occasional chore into a living routine that meets the scale and urgency of the crises now unfolding on both coasts. In short, our app makes sustainable living actionable, social, and measurable - “making the world 0.1 % greener every day through technology and community.”</p>
    <ul>
      <li>Built the full Figma design system and coded splash, login, and registration flows in Jetpack Compose + Material 3</li>
      <li>Containerized and deployed a FastAPI + PostgreSQL backend whose async endpoints serve trail and climate data</li>
      <li>Wrote Python ingestion jobs to pull, clean, and schedule-update third-party climate/event feeds, ensuring fresh, reliable data </li>
    </ul>
    <div class="screenshots">
      <h4>Screenshots</h4>
      <div class="image-row">
        <div class="image-container">
          <img src="images/Sustain1.png" alt="Onboarding Page" />
          <figcaption>Oboarding Page</figcaption>
        </div>
        <div class="image-container">
          <img src="images/Sustain2.png" alt="Home Screen" />
          <figcaption>Home Screen</figcaption>
        </div>
        <div class="image-container">
          <img src="images/Sustain3.png" alt="Events Page" />
          <figcaption>Events Page</figcaption>
        </div>
        <div class="image-container">
          <img src="images/Sustain4.png" alt="Settings Page" />
          <figcaption>Settings Page</figcaption>
        </div>
      </div>
    </div>
    <p><strong>Links:</strong></p>
    <ul>
      <li><a href="https://www.figma.com/design/IzgEmtNhrfn7mDFpXdoAIM/Sustain-Trail?node-id=0-1&t=fP1msGLHQ4H2ptZC-1" target="_blank">Figma Design</a></li>
      <li><a href="https://gitlab.com/mc-capstone/SustenanceAndroid" target="_blank">GitHub Repository App</a></li>

      <li><a href="https://landingpages-028db6.gitlab.io/" target="_blank">App Website</a></li>
    </ul>
  </div>
  <!-- Project 1 -->
  <div class="project">
    <h3>DOR – Digitized Observation Rubric</h3>
    <p><strong>Role:</strong> Product Manager, Developer, Designer</p>
    <p class="project-summary"> An iPad app developed for the Chair of Education at Manhattan College to digitize the observation and scoring process for student teachers, replacing pen-and-paper checklists with a robust native iOS experience.</p>
    <ul>
      <li>Led client communications and defined functional requirements for rubric creation, scoring, and data reporting.</li>
      <li>Designed complete UI/UX in Figma, focusing on clarity, focus, and real-time scoring usability.</li>
      <li>Built custom forms (checklist page) to manage categories, sub-categories, dynamic scores, counters, and rubric comments.</li>
      <li>Implemented local storage and offline functionality to support privacy and reliability in low-connectivity classrooms.</li>
    </ul>
    <div class="screenshots">
      <h4>Screenshots</h4>
      <div class="image-row">
        <div class="image-container">
          <img src="images/checklist_page.PNG" alt="Checklist Page" />
          <figcaption>Checklist Page</figcaption>
        </div>
        <div class="image-container">
          <img src="images/student_profile.PNG" alt="Student Profile" />
          <figcaption>Student Profile</figcaption>
        </div>
        <div class="image-container">
          <img src="images/home_screen.PNG" alt="Home Screen" />
          <figcaption>Home Screen</figcaption>
        </div>
      </div>
    </div>
    <p><strong>Links:</strong></p>
    <ul>
      <li><a href="https://www.figma.com/design/pqn4Yp57LnA5tRfVbVVe58/DOR?node-id=5-19&t=TeNGgJr6kRC5P4aV-1" target="_blank">Figma Design</a></li>
      <li><a href="https://github.com/CodeWithTejpratab/OrchenIPadApp" target="_blank">GitHub Repository</a></li>
    </ul>
  </div>

  <!-- Project 2 -->
  <div class="project">
    <h3>Detecting Inconsistencies in SNOMED CT</h3>
    <p><strong>Role:</strong> Researcher & ML Developer</p>
    <p class="project-summary">For this project, I used machine learning and sibling-concept analysis to detect modeling inconsistencies in SNOMED CT, a medical terminology standard used in 80+ countries. Presented at Manhattan College’s research symposium.</p>
    <ul>
      <li>Built an auditing pipeline using Word2Vec and attribute modeling to identify semantic mismatches between 350K+ clinical concepts.</li>
      <li>Flagged attribute inconsistencies with ~83% precision by analyzing lexical and structural similarity across hierarchies.</li>
      <li>Optimized MySQL-based data retrieval through indexing, normalization, batching, and caching to improve audit performance.</li>
      <li>Visualized clustering of similar terms and audited output via accuracy dashboards, driving faster manual verification.</li>
    </ul>
    <div class="screenshots">
      <h4>Screenshots</h4>
      <div class="image-row">
        <div class="image-container">
          <img src="images/fig4.png" alt="Similarity Visualization" />
          <figcaption>Similarity Visualization</figcaption>
        </div>
        <div class="image-container">
          <img src="images/fig5.png" alt="Audit Results" />
          <figcaption>Audit Results</figcaption>
        </div>
      </div>
    </div>
    <p><strong>Links:</strong></p>
    <ul>
      <li><a href="https://github.com/elevin01/Summer-Research?tab=readme-ov-file" target="_blank">Project Code on GitHub</a></li>
    </ul>
  </div>

  <!-- Project 3 -->
  <div class="project">
    <h3>Matrix Calculator for iOS</h3>
    <p><strong>Role:</strong> Developer</p>
    <p class="project-summary">High-performance matrix calculator app (iOS) built using C++ and Objective-C++ to support intensive computation with real-time UI interaction.</p>
    <ul>
      <li>Implemented Gauss and Gauss-Jordan elimination algorithms in a C++ backend with Objective-C++ bridging.</li>
      <li>Designed and integrated a responsive SwiftUI interface for dynamic matrix input and result rendering.</li>
      <li>Handled runtime validation for matrix dimensions and edge cases to ensure fault-tolerant operations.</li>
    </ul>
    <div class="screenshots">
      <h4>Screenshots</h4>
      <div class="image-row">
        <div class="image-container">
          <img src="images/matrix_home.png" alt="Matrix Home Screen" />
          <figcaption>Home Screen</figcaption>
        </div>
        <div class="image-container">
          <img src="images/matrix_result.png" alt="Matrix Result Screen" />
          <figcaption>Result Screen</figcaption>
        </div>
      </div>
    </div>
    <p><strong>Links:</strong></p>
    <ul>
      <li><a href="https://www.figma.com/design/1XfQEsHopPjwN5zXA8ZKdD/NumComp-Project?t=55tMDvTMjGb1WVKr-1" target="_blank">Figma Design</a></li>
      <li><a href="https://github.com/CodeWithTejpratab/IOS-app-Matrix-calculator" target="_blank">GitHub Repository</a></li>
    </ul>
  </div>
</section>


    <!-- Contact Section -->
    <section id="contact" class="section">
      <h2>Contact</h2>
      <div class="contact-card">
        <p>If you're interested in collaborating or have a role in mind, reach out via email or connect on LinkedIn/GitHub.</p>
        <div class="contact-actions">
          <a class="contact-btn" href="mailto:emiltlevin@gmail.com">Email Me</a>
          <a class="contact-btn secondary" href="https://linkedin.com/in/elevin01" target="_blank">LinkedIn</a>
          <a class="contact-btn secondary" href="https://github.com/elevin01" target="_blank">GitHub</a>
        </div>
      </div>
    </section>
  </main>

  <!-- Hidden 2048 Mini-Game Trigger -->
  <button id="gameToggle" class="game-toggle" aria-label="Open 2048 mini game"></button>

  <!-- 2048 Mini-Game Modal -->
  <div id="gameModal" class="game-modal" aria-hidden="true">
    <div class="game-modal-content">
      <div class="game-modal-header">
        <h3>2048 Mini Game</h3>
        <button class="game-close" id="gameClose" aria-label="Close 2048 mini game">&times;</button>
      </div>
      <p class="game-instructions">Use arrow keys or WASD to slide tiles. Combine them to reach 2048.</p>
      <div class="game-score">
        <span>Score:</span> <strong id="gameScore">0</strong>
      </div>
      <div id="gameGrid" class="game-grid" role="grid" aria-label="2048 grid">
        <!-- Tiles injected by JS -->
      </div>
      <div class="game-actions">
        <button id="gameReset" class="contact-btn secondary">Reset</button>
      </div>
      <p id="gameStatus" class="game-status" aria-live="polite"></p>
    </div>
  </div>

  <!-- JavaScript for scroll spy to update active nav link -->
  <script>
    const sections = document.querySelectorAll('section');
    const navItems = document.querySelectorAll('.nav ul li');

    window.addEventListener('scroll', () => {
      let currentSection = '';
      sections.forEach(section => {
        const sectionTop = section.offsetTop;
        if (pageYOffset >= sectionTop - 60) {
          currentSection = section.getAttribute('id');
        }
      });
      navItems.forEach(li => {
        li.classList.remove('active');
        if (li.querySelector('a').getAttribute('href').substring(1) === currentSection) {
          li.classList.add('active');
        }
      });
    });

    // 2048 mini game
    const gameToggle = document.getElementById('gameToggle');
    const gameModal = document.getElementById('gameModal');
    const gameClose = document.getElementById('gameClose');
    const gameGridEl = document.getElementById('gameGrid');
    const gameScoreEl = document.getElementById('gameScore');
    const gameStatusEl = document.getElementById('gameStatus');
    const gameReset = document.getElementById('gameReset');

    let grid = [];
    let score = 0;
    let gameOpen = false;
    let lastNewTile = null;
    let mergedThisMove = [];

    const size = 4;
    const directions = {
      ArrowUp: 'up',
      ArrowDown: 'down',
      ArrowLeft: 'left',
      ArrowRight: 'right',
      w: 'up', W: 'up',
      s: 'down', S: 'down',
      a: 'left', A: 'left',
      d: 'right', D: 'right'
    };

    function openGame() {
      gameModal.classList.add('open');
      gameModal.setAttribute('aria-hidden', 'false');
      gameOpen = true;
      initGame();
    }

    function closeGame() {
      gameModal.classList.remove('open');
      gameModal.setAttribute('aria-hidden', 'true');
      gameOpen = false;
    }

    function initGame() {
      grid = Array.from({ length: size }, () => Array(size).fill(0));
      score = 0;
      addRandomTile();
      addRandomTile();
      render();
      gameStatusEl.textContent = '';
    }

    function addRandomTile() {
      const empty = [];
      for (let r = 0; r < size; r++) {
        for (let c = 0; c < size; c++) {
          if (grid[r][c] === 0) empty.push([r, c]);
        }
      }
      if (empty.length === 0) return;
      const [r, c] = empty[Math.floor(Math.random() * empty.length)];
      grid[r][c] = Math.random() < 0.9 ? 2 : 4;
      lastNewTile = `${r}-${c}`;
    }

    function rotateClockwise(matrix) {
      return matrix[0].map((_, i) => matrix.map(row => row[i]).reverse());
    }

    function mapBack(row, col, direction) {
      if (direction === 'left') return { r: row, c: col };
      if (direction === 'right') return { r: row, c: size - 1 - col };
      if (direction === 'up') return { r: size - 1 - col, c: row };
      // down
      return { r: col, c: size - 1 - row };
    }

    function move(direction) {
      let changed = false;
      let workingGrid = grid.map(row => row.slice());
      const mergePositionsOrientation = [];

      // Rotate grid so we can always move left
      if (direction === 'up') workingGrid = rotateClockwise(rotateClockwise(rotateClockwise(workingGrid)));
      if (direction === 'down') workingGrid = rotateClockwise(workingGrid);
      if (direction === 'right') workingGrid = workingGrid.map(row => row.reverse());

      const newGrid = workingGrid.map((row, baseRow) => {
        const filtered = row.filter(n => n !== 0);
        const merged = [];
        let skip = false;
        for (let i = 0; i < filtered.length; i++) {
          if (skip) { skip = false; continue; }
          if (filtered[i] === filtered[i + 1]) {
            const val = filtered[i] * 2;
            merged.push(val);
            score += val;
            skip = true;
            mergePositionsOrientation.push({ rowIndex: merged.length - 1, baseRow });
          } else {
            merged.push(filtered[i]);
          }
        }
        while (merged.length < size) merged.push(0);
        return merged;
      });

      // Undo rotation
      let restored = newGrid;
      if (direction === 'up') restored = rotateClockwise(restored);
      if (direction === 'down') restored = rotateClockwise(rotateClockwise(rotateClockwise(restored)));
      if (direction === 'right') restored = restored.map(row => row.reverse());

      mergedThisMove = mergePositionsOrientation.map(pos => {
        const mapped = mapBack(pos.baseRow, pos.rowIndex, direction);
        return `${mapped.r}-${mapped.c}`;
      });

      // Check change
      for (let r = 0; r < size; r++) {
        for (let c = 0; c < size; c++) {
          if (restored[r][c] !== grid[r][c]) {
            changed = true;
            break;
          }
        }
        if (changed) break;
      }

      if (changed) grid = restored;
      return changed;
    }

    function hasMoves() {
      for (let r = 0; r < size; r++) {
        for (let c = 0; c < size; c++) {
          if (grid[r][c] === 0) return true;
          if (c < size - 1 && grid[r][c] === grid[r][c + 1]) return true;
          if (r < size - 1 && grid[r][c] === grid[r + 1][c]) return true;
        }
      }
      return false;
    }

    function render() {
      gameGridEl.innerHTML = '';
      grid.forEach((row, rIdx) => {
        row.forEach((val, cIdx) => {
          const tile = document.createElement('div');
          tile.className = 'game-tile';
          tile.setAttribute('role', 'gridcell');
          tile.setAttribute('aria-label', val ? `Tile ${val}` : 'Empty');
          if (val) {
            tile.textContent = val;
            tile.classList.add(`t-${val}`);
            const key = `${rIdx}-${cIdx}`;
            if (key === lastNewTile) tile.classList.add('new');
            if (mergedThisMove.includes(key)) tile.classList.add('merged');
          }
          tile.dataset.pos = `${rIdx}-${cIdx}`;
          gameGridEl.appendChild(tile);
        });
      });
      gameScoreEl.textContent = score;

      if (!hasMoves()) {
        gameStatusEl.textContent = 'Game over! Press reset to play again.';
      } else {
        gameStatusEl.textContent = '';
      }
      mergedThisMove = [];
      lastNewTile = null;
    }

    function handleKeydown(e) {
      if (!gameOpen) return;
      const dir = directions[e.key];
      if (!dir) return;
      e.preventDefault();
      if (move(dir)) {
        addRandomTile();
        render();
      }
    }

    gameToggle.addEventListener('click', openGame);
    gameClose.addEventListener('click', closeGame);
    gameReset.addEventListener('click', initGame);
    window.addEventListener('keydown', handleKeydown);

    // Close modal on backdrop click
    gameModal.addEventListener('click', (e) => {
      if (e.target === gameModal) closeGame();
    });
  </script>
</body>
</html>
